#!/usr/bin/env node

var docopt = require('docopt').docopt;
var fs = require('fs');

var doc = 'Usage: cmi GISTID' +
'\n' +
'\nOptions:' +
'\n  -h --help     Show this screen.' +
'\n  -v --version  Output version.';
var cli = docopt(doc, {help: true, version: '0.1.0'});
// return console.log(cli);

require('chainy').create().require('autoinstall')
	.require('set feed map')
	.set('https://api.github.com/gists/'+cli['GISTID'])
	.feed()
	// get the 'files' object
	.action(function(currentChainValue){
		return currentChainValue.files;
	})
	.map(function(value){
		// console.log(value['filename']);
		fs.writeFile('./'+value['filename'], value['content'], function(err){
			if (err) return console.log(err);
		});
	})
	.done(function(err, result){
		if (err) return console.log(err.stack || err);
		else return;
	})

